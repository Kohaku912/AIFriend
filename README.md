# まなとも — 学力向上チャットアプリ（コンテスト提出用）

## 概要

**まなとも** は、小中高生が教科ごとのキャラクター（AIペルソナ）と会話しながら学習できるチャット型の学習支援アプリです。友達のようなキャラが問題を出したり、解説したり、リスニング音声を再生したりして、ゲーム感覚で学習を進められます。

* ターゲット：小学生〜高校生、および学習支援を行いたい教育者
* 目的：親しみやすい対話インターフェースで継続学習を促進し、ジャンル別・サブフィールド別の成績解析で弱点を可視化する。

## 特徴（機能ハイライト）

* **キャラクターベースの会話**：国語・数学・理科・社会・英語それぞれの個性あるAIペルソナと会話。ペルソナは問題の出題スタイルや口調を変え、学習の没入感を高めます。
* **クイズ（確認問題）生成**：AIが会話文の末尾に特定フォーマット（`<<QUIZ>>...<<ENDQUIZ>>`）のJSONを出力し、フロントが検知して問題として表示します。MCQ・テキスト回答に対応。
* **リスニング（TTS）**：英語リスニング問題では再生ボタンが表示され、ブラウザのSpeechSynthesisを使って音声再生が可能。音量は設定から変更できます。
* **ルビ自動生成**：漢字にルビ（ふりがな）を付ける機能。`kuromoji` を使ったサーバー側APIで日本語テキストを解析してルビタグを生成します。ユーザー側でON/OFF可能。
* **学習統計**：ローカルに保存された解答履歴からジャンル別・サブフィールド別の成績（正答率）を算出。弱点・得意分野を表示、詳細表示で棒グラフや表で確認可能。
* **送信上限・レート制御**：サーバー側でIPベースの簡易レート制限（デフォルト40/日）を実装。フロントでも当日カウントを保持してUIへ反映します。
* **操作しやすいUI**：フォントサイズ、ルビ表示、音量、漢字レベル（中学生〜小学1年まで）などを設定可能。クイズは一度のみ回答できる仕組み。

## 技術スタック

* フロントエンド：React（シングルファイル構成のコンポーネント）
* バックエンド：Node.js + Express
* 日本語解析：kuromoji（サーバー）
* AI：Google GenAI（Gemini）を想定（`@google/genai` ライブラリ経由）
* 永続化（クライアント）：`localStorage`（メッセージや解答履歴、設定を保存）
* TTS：ブラウザの `speechSynthesis` API

## 主要エンドポイント

* `POST /api/chat` — ユーザーのメッセージを受け取り、AI応答（および必要なら `<<QUIZ>>...<<ENDQUIZ>>` を含む）を返す。

  * リクエスト例（JSON）: `{ message, personality, previous, kanjiLevel }`

* `POST /api/ruby` — 日本語テキストを受け取り、ルビ（HTMLの `<ruby>`） を返す。kuromojiトークナイザを使用。

  * リクエスト例（JSON）: `{ text }`
  * レスポンス例（JSON）: `{ ruby: "<ruby>漢字<rt>かんじ</rt></ruby>..." }`

## セットアップ（開発用）

### 前提

* Node.js（推奨: 16+）
* npm または yarn
* `kuromoji` の dict が `node_modules/kuromoji/dict` に配置されること
* Gemini 等のAIを使う場合はAPIキー（環境変数）を用意

### サーバー（起動例）

```bash
# サーバーディレクトリで
npm install
# 環境変数を設定
# 例: export GEMINI_API_KEY=your_key
# Windows (PowerShell): $env:GEMINI_API_KEY = "your_key"

node server-for-quiz.js
# デフォルトで http://localhost:4000 に起動
```

**必要な環境変数**

* `GEMINI_API_KEY` — （必須）Gemini または利用するAIのAPIキー
* `PORT` — （任意）サーバーのポート（デフォルト 4000）

### フロント（起動例）

フロントは通常のReactアプリとして組み込みます。今回のコードは単一ファイルのReactコンポーネントを想定しています。

```bash
# フロントのプロジェクトルートで
npm install
npm start
# ブラウザで http://localhost:3000 を開く（create-react-app等を使用している場合）
```

フロントは `http://localhost:4000/api/chat` と通信するようにコーディングされています。デプロイ時は適宜APIのURLを変更してください。

## 設計上のポイント・注意点

* **クイズのフォーマット厳格化**：AIに `<<QUIZ>>...<<ENDQUIZ>>` の中でJSONを出すよう強制しており、フロントはそれを検出してUI上の問題として扱います。JSONが不完全な場合、サーバー側で再生成を1回試みます。
* **ローカル保存**：解答履歴や設定は `localStorage` に保存されます。これによりオフラインでも履歴が残りますが、他の端末間で同期はされません。
* **レートリミット**：簡易なIPベースのカウント実装のため、プロダクション環境では Redis 等の永続ストアまたはクラウドAPIゲートウェイでの制御を推奨します。
* **kuromoji の読み**：特殊読み（固有表現など）は `specialReadings` で補正できます。より精度を上げたい場合は辞書やルールの拡張を検討してください。

## プライバシーとセキュリティ

* 本実装ではユーザーの会話や成績はローカルにのみ保存されます（サーバー側は簡易的に直近会話をメモしているが、恒久的保存はしていません）。
* AIに送信されるテキストは第三者サービス（Gemini等）に送られます。個人情報を含めない運用ルールを制定してください。
* APIキーは必ずサーバー側環境変数で管理し、クライアントに埋め込まないでください。

## デモ・提出時の説明ポイント（コンテスト用）

* ユーザーがチャットを送ると、キャラクターが親しみやすい口調で応答し、必要に応じて確認問題を出題します。
* リスニング問題は再生ボタンを押すとブラウザで音声再生し、聞き取った単語を入力して答えられます。
* 学習統計はジャンル別・サブフィールド別に可視化され、苦手分野の把握に役立ちます。
* UIは「勉強っぽさ」を前面に出さず、親しみやすいキャラクター体験を重視しています（継続利用を狙ったUX設計）。

## 既知の制限・今後の改善案

* 現状はローカル保存中心。アカウント同期（クラウド保存）を導入して複数端末での学習履歴共有に対応する。
* レート制御を堅牢化（Redisや外部API管理）する。
* AIの出力検証を強化して、クイズJSONの信頼性を高める。出題バリエーションや難易度調整を追加する。
* TTSの音声品質向上や発音評価（発音フィードバック）機能を追加。
* アクセシビリティ（高コントラスト、キーボード操作）対応を拡充。

## ライセンス

このリポジトリのコードは（適宜選択してください）MITライセンスなどのオープンソースライセンスで配布できます。コンテストの応募規約に合わせて適切に設定してください。

---

### 作者 / 連絡先

開発チーム: （あなたの名前やチーム名をここに）

（必要ならばデモURLやスクリーンショット、プレゼン資料のリンクを追記してください。）

---

以上が提出用READMEのテンプレートです。必要なら提出用に要点を短くまとめた『ワンページ概要』や、コンテスト審査員向けの『デモ操作手順（箇条書き）』も作成します。ご希望があれば作ります！
