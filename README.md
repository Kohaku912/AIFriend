# まなとも — 学力向上チャットアプリ

## 概要

**まなとも** は、小中高生が教科ごとのキャラクターと会話しながら学習できるチャット型の学習支援アプリです。友達のようなキャラが問題を出したり、解説したり、リスニング音声を再生したりして、友達と会話する感覚で学習を進められます。

* ターゲット：小学生〜高校生
* 目的：親しみやすい対話インターフェースで継続学習を促進し、ジャンル別・サブフィールド別の成績解析で得意、苦手を可視化する。

## 特徴（機能ハイライト）

* **キャラクターベースの会話**：国語・数学・理科・社会・英語それぞれの個性あるキャラクターと会話。キャラクターはそれぞれ性格や口調が違い、楽しく会話できます。
* **クイズ生成**：AIが会話文の末尾に特定フォーマット（`<<QUIZ>>...<<ENDQUIZ>>`）のJSONを出力し、フロントが検知して問題として表示します。MCQ・テキスト回答・リスニング問題に対応。
* **リスニング**：英語リスニング問題では再生ボタンが表示され、ブラウザのSpeechSynthesisを使って音声再生が可能。音量は設定から変更できます。
* **ルビ自動生成**：漢字にルビ（ふりがな）を付ける機能。`kuromoji` を使ったサーバー側APIで日本語テキストを解析してルビタグを生成します。ユーザー側でON/OFF可能。
* **学習統計**：ローカルに保存された解答履歴から教科別・単元別の成績（正答率）を算出。苦手・得意分野を表示、詳細表示で棒グラフや表で確認可能。
* **送信上限・レート制御**：サーバー側でIPベースの簡易レート制限（デフォルト40/日）を実装。フロントでも当日カウントを保持してUIへ反映します。
* **操作しやすいUI**：フォントサイズ、ルビ表示、音量、漢字レベル（中学生〜小学1年まで）などを設定可能。

## 技術スタック

* フロントエンド：React（シングルファイル構成のコンポーネント）
* バックエンド：Node.js + Express
* 日本語解析：kuromoji（サーバー）
* AI：Google GenAI（Gemini）
* 永続化（クライアント）：`localStorage`（メッセージや解答履歴、設定を保存）
* TTS：ブラウザの `speechSynthesis` API

## 主要エンドポイント

* `POST /api/chat` — ユーザーのメッセージを受け取り、AI応答（および必要なら `<<QUIZ>>...<<ENDQUIZ>>` を含む）を返す。

  * リクエスト例（JSON）: `{ message, personality, previous, kanjiLevel }`

* `POST /api/ruby` — 日本語テキストを受け取り、ルビ（HTMLの `<ruby>`） を返す。kuromojiトークナイザを使用。

  * リクエスト例（JSON）: `{ text }`
  * レスポンス例（JSON）: `{ ruby: "<ruby>漢字<rt>かんじ</rt></ruby>..." }`

## プライバシーとセキュリティ

* 本実装ではユーザーの会話や成績はローカルにのみ保存されます（サーバー側は簡易的に直近会話をメモしているが、恒久的保存はしていません）。
* AIに送信されるテキストは第三者サービス（Gemini等）に送られます。個人情報を含めない運用ルールを制定してください。
* APIキーは必ずサーバー側環境変数で管理し、クライアントに埋め込まないでください。

## 既知の制限・今後の改善案

* 現状はローカル保存中心。アカウント同期（クラウド保存）を導入して複数端末での学習履歴共有に対応する。
* レート制御を堅牢化（Redisや外部API管理）する。
* AIの出力検証を強化して、クイズJSONの信頼性を高める。出題バリエーションや難易度調整を追加する。
* TTSの音声品質向上やスピーキング評価（発音フィードバック）機能を追加。

